{% extends 'blog/base.html' %}
{% block content %}

  

{% for post in posts %}
<article class="media content-section">
    <img class="rounded-circle article-img" src="{{ post.author.profile.image.url }}" alt="Author Image">
    <div class="media-body">
        <div class="article-metadata">
          <a class="mr-2" href="{% url 'user-profile' post.author.username %}">{{ post.author }}</a>
            <small class="text-muted">{{ post.date_posted }}</small>
        </div>
        <h2><a class="article-title" href="{% url 'blog-detail' post.id %}">{{ post.title }}</a></h2>
        <p class="article-content">{{ post.content }}</p>
        {% if post.image %}
        <img src="{{ post.image.url }}" alt="Blog Image" style="max-width: 100%; height: auto;">
        {% endif %}
        <br>
        <br>

        <!-- Like Button Form -->
<form class="like-form" data-post-id="{{ post.id }}">
    {% csrf_token %}
    <button type="submit" class="btn btn-outline-primary like-button">
        üëç Like
    </button>

    <!-- Like Count -->
    <span class="like-count">{{ post.total_likes }}</span>
</form>
    </div>
</article>

<script>
    document.addEventListener("DOMContentLoaded", function () {
      document.querySelectorAll(".like-form").forEach((form) => {
        form.addEventListener("submit", function (e) {
          e.preventDefault(); // Stop the page from refreshing
  
          const postId = this.dataset.postId;
          const likeBtn = this.querySelector(".like-button");
          const likeCount = this.querySelector(".like-count");
          const csrfToken = this.querySelector("[name=csrfmiddlewaretoken]").value;
  
          // Send AJAX request
          fetch(`/like/${postId}/`, {
            method: "POST",
            headers: {
              "X-CSRFToken": csrfToken,
              "Content-Type": "application/x-www-form-urlencoded",
            },
          })
          .then(response => response.json())
          .then(data => {
            if (data.liked) {
              likeBtn.classList.add("liked");
            } else {
              likeBtn.classList.remove("liked");
            }
            likeCount.textContent = data.total_likes; // Update like count
          })
          .catch(error => console.error("Error:", error));
        });
      });
    });
  </script>
  

{% endfor %}
{% endblock content %}